# 性能优化

## 懒加载（延迟加载、按需加载）：长网页，延时加载图片

1. 减少无用资源的加载，（减轻服务器的压力和流量）；
2. 提升用户体验；（同时加载较多图片，可能需要等待的时间较长）
3. 防止加载过多图片而影响其他资源文件的加载；

在需要加载图片的时候，将 data-xxx 中图片的路径赋值给 src；

- 实现
  1. window.innerHeight: 是浏览器可视区的高度;
  2. document.body.scrollTop/document.documentElement.scrollTop: 是浏览器滚动的过的距离;
  3. img.offsetTop 是元素顶部距离文档顶部的高度（包括滚动条的距离）;
  4. 图片加载条件：img.offsetTop < window.innerHeight+document.body.scrollTop;

## 重排（回流）与重绘

- 重排（回流）：
  当渲染树中部分或者全部元素的尺寸、结构或者属性发生变化时，浏览器会重新渲染部分或者全部文档的过程就称为回流。

  1. 页面的首次渲染
  2. 浏览器的窗口大小发生变化
  3. 元素的内容发生变化
  4. 元素的尺寸或者位置发生变化
  5. 元素的字体大小发生变化
  6. 激活 CSS 伪类
  7. 查询某些属性或者调用某些方法
  8. 添加或者删除可见的 DOM 元素

  - 由于浏览器渲染页面是基于流式布局的，所以当触发回流时，会导致周围的 DOM 元素重新排列，它的影响范围有两种：

    1. 全局范围：从根节点开始，对整个渲染树进行重新布局
    2. 局部范围：对渲染树的某部分或者一个渲染对象进行重新布局

- 重绘：
  当页面中某些元素的样式发生变化，但是不会影响其在文档流中的位置时，浏览器就会对元素进行重新绘制，这个过程就是重绘。

  1. color、background 相关属性：background-color、background-image 等
  2. outline 相 关 属 性 ： outline-color 、outline-width、ext-decoration、 border-radius、visibility、box-shadow

- **注**： 当触发“重排（回流）”时，一定会触发“重绘”，但是“重绘”不一定会引发“重排（回流）”。

- 如何避免“重排（回流）”与重绘？

  1. 操作 DOM 时，尽量在低层级的 DOM 节点进行操作；
  2. 不要使用 table 布局， 一个小的改动可能会使整个 table 进行重新布局；
  3. 使用 CSS 的表达式；
  4. 不要频繁操作元素的样式，对于静态页面，可以修改类名，而不是样式；
  5. 使用 absolute 或者 fixed，使元素脱离文档流，这样他们发生变化就不会影响其他元素；
  6. 避免频繁操作 DOM，可以创建一个文档片段 documentFragment，在它上面应用所有 DOM 操作，最后再把它添加到文档中；
  7. 将元素先设置 display: none，操作结束后再把它显示出来。（因为在 display 属性为 none 的元素上进行的 DOM 操作不会引发回流和重绘）
  8. 将 DOM 的多个读操作（或者写操作）放在一起，而不是读写操作穿插着写（这得益于浏览器的渲染队列机制）。
     - 浏览器针对页面的回流与重绘，进行了自身的优化——渲染队列；
     - 浏览器会将所有的回流、重绘的操作放在一个队列中，当队列中的操作到了一定的数量或者到了一定的时间间隔，浏览器就会对队列进行批处理。这样就会让多次的回流、重绘变成一次回流重绘。
     - 上面，将多个读操作（或者写操作）放在一起，就会等所有的读操作进入队列之后执行，这样，原本应该是触发多次回流，变成了只触发一次回流。

## 如何优化动画？

动画需要频繁的操作 DOM，就就会导致页面的性能问题；  
将动画的 position 属性设置为 absolute 或者 fixed，将动画脱离文档流

## 节流函数和防抖函数

## 项目中的图片进行优化

1. css 代替；
2. CDN 加速；
3. 小图 base64 格式；
4. iconfont；
5. 多个小图合并到一张中（雪碧图）；
6. 正确选择图片格式；
   - BMP，是无损的、既支持索引色也支持直接色的点阵图
   - GIF 是无损的、采用索引色的点阵图。
   - JPEG 是有损的、采用直接色的点阵图；
   - PNG-8 是无损的、使用索引色的点阵图。
   - PNG-24 是无损的、使用直接色的点阵图。
   - SVG 是无损的矢量图。
   - WebP 是谷歌开发的一种新图片格式，WebP 是同时支持有损和无损压缩的、使用直接色的点阵图。
