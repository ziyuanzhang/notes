## 事件循环机制 -- 浏览器端

由于浏览器页面的渲染进程要执行很多任务，如 DOM 构建、样式计算、布局计算、绘制、JavaScript 执行、接收输入事件等，并且这些任务因为需要交互性来不断产生，无法事先安排，因此需要一个任务调度系统来统筹规划这些任务的执行。在浏览器中，统筹调度任务的系统就是事件循环系统（Event-Loop）

**重要重要：**

1.  “事件循环”决定了 js 引擎（V8）什么时候执行什么代码；
    js 引擎（V8）只是负责 JS 代码的解析和执行，其他它一概不知。
    浏览器或者 NodeJS 中触发事件之后 到 回调函数被 V8 执行，这个时间段的所有工作都是事件循环在起作用

2.  事件循环有**多个**任务队列（task queues）参与；任务队列是任务（task）的有序列表

3.  我们写的 javascript 代码只在一个线程上运行（渲染进程 中的 JS 引擎线程），称之为主线程；  
    HTML5 提供了 web worker API 可以让浏览器开一个线程运行比较复杂耗时的 javascript 任务，但是这个线程仍受主线程的控制。

4.  事件循环运行在一个单独的线程里面

5.  浏览器会把同步代码捆绑在一起执行，然后以执行结果为当前状态进行渲染。

#### 事件循环系统在于“事件”和“循环”这两个概念

**事件：**接收外部的输入事件，产生任务；  
**循环：**线程执行完任务后并不退出，而是循环等待输入事件产生的任务并执行

事件循环的主要机制就是任务队列机制:

1. 来自同一个特定任务源且属于特定事件循环的任务必须被加入到同一个任务队列中，来自不同任务源的任务可以放在不同的任务队列中;
2. 浏览器调用这些队列中的任务时采取这样的做法: 相同队列中的任务按照先进先出的顺序, 不同的队列按照提前设置的队列优先级来调用.不保证多个任务队列中的任务优先级，具体实现可能会交叉执行

在调用任务的过程中, 会产生新的任务, 浏览器就会不断执行任务, 因此称为事件循环.
